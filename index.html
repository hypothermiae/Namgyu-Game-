<!DOCTYPE html>
<html lang="en">
<link rel="manifest" href="manifest.json">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
  }
</script>
>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Namgyu Game</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial, sans-serif; }
#gameArea { width:100vw; height:100vh; position:relative; background:url('backround.png') no-repeat center/cover; overflow:hidden; }
.namling { position:absolute; width:80px; height:80px; cursor:pointer; transition: transform 0.1s; }
.namling.panic { transform: scale(1.2); }
.happiness-bar { position:absolute; width:80px; height:6px; background:#ccc; border-radius:3px; overflow:hidden; top:-10px; }
.happiness-fill { height:100%; background:#4caf50; width:50%; transition:width 0.3s; }
#uiButtons { position:absolute; top:10px; right:10px; z-index:100; display:flex; gap:10px; }
#uiButtons img { width:70px; height:70px; cursor:pointer; }
#namcoinsDisplay { position:absolute; top:10px; left:10px; font-size:20px; font-weight:bold; display:flex; align-items:center; gap:5px; z-index:100; }
#namcoinsDisplay img { width:40px; height:40px; }
.overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.9); color:#fff; display:none; flex-direction:column; align-items:center; justify-content:flex-start; padding:20px; z-index:200; overflow-y:auto; }
.overlay h2 { margin-bottom:20px; }
.overlay .item { display:flex; align-items:center; margin:5px 0; gap:10px; }
.overlay .item img { width:40px; height:40px; }
.overlay button { margin-left:10px; padding:5px 10px; }
.tutorialPopup { position:absolute; top:50px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.9); color:#000; padding:15px 25px; border-radius:10px; font-size:18px; z-index:500; }
.miniTarget { position:absolute; width:40px; height:40px; background:gold; border-radius:50%; cursor:pointer; }
</style>
</head>
<body>

<div id="gameArea"></div>

<div id="uiButtons">
  <img src="nambook.png" alt="Inventory" title="Inventory" onclick="openInventory()">
  <img src="shop-icon.png" alt="Shop" title="Shop" onclick="openShop()">
  <img src="settings-icon.png" alt="Settings" title="Settings" onclick="openSettings()">
  <button onclick="startMiniGame()" style="font-size:16px;cursor:pointer;">Mini-Game</button>
</div>

<div id="namcoinsDisplay">
  <img src="piggybank.png" alt="Namcoins">
  <span id="coinCount">0</span>
</div>

<div id="tutorial" class="tutorialPopup"></div>

<div id="inventoryOverlay" class="overlay">
  <h2>Inventory</h2>
  <div id="inventoryList"></div>
  <button onclick="closeOverlay()">Close</button>
</div>

<div id="shopOverlay" class="overlay">
  <h2>Shop</h2>
  <div id="shopList"></div>
  <button onclick="closeOverlay()">Close</button>
</div>

<div id="settingsOverlay" class="overlay">
  <h2>Settings</h2>
  <button onclick="resetGame()">Reset Game</button>
  <div>
    <label>Music: </label>
    <button onclick="toggleMusic()">Toggle Music</button>
  </div>
  <button onclick="closeOverlay()">Close</button>
</div>

<audio id="bgMusic" src="cute-namgyu-tune.mp3.mp3" loop autoplay></audio>

<script>
// --- Game State ---
let namcoins = 150;
const namcoinsDisplay = document.getElementById('coinCount');
const gameArea = document.getElementById('gameArea');
const tutorialDiv = document.getElementById('tutorial');
const bgMusic = document.getElementById('bgMusic');

const foodItems = [
  { name:'Apple', price:5 },
  { name:'Banana', price:10 },
  { name:'Cake', price:20 },
  { name:'Namtoy', price:15 }
];

const eggs = [
  { name:'Common Egg', img:'egg1.png', price:50, range:[1,5] },
  { name:'Uncommon Egg', img:'egg2.png', price:100, range:[6,10] },
  { name:'Rare Egg', img:'egg3.png', price:150, range:[11,15] },
  { name:'Ultra Rare Egg', img:'egg4.png', price:500, range:[16,19] }
];

const inventory = {};
let hatchedNamlings = [];
let namlings = [];
let namlingElements = [];
let selectedNamling = null;

namcoinsDisplay.textContent = namcoins;

// --- Auto-save/load ---
function saveGame(){ localStorage.setItem('namgyuSave', JSON.stringify({namcoins, inventory, hatchedNamlings, namlings})); }
function loadGame(){
  const state = JSON.parse(localStorage.getItem('namgyuSave'));
  if(state){
    namcoins = state.namcoins || 150;
    Object.assign(inventory, state.inventory || {});
    hatchedNamlings = state.hatchedNamlings || [];
    namlings = state.namlings || [];
    namlingElements.push(...namlings.map(createNamling));
  }
  namcoinsDisplay.textContent = namcoins;
}
loadGame();

// --- Create Namling ---
function createNamling(n){
  const div = document.createElement('div');
  div.classList.add('namling');
  div.style.left = n.x+'px';
  div.style.top = n.y+'px';
  div.style.backgroundImage = `url('${n.img}')`;
  div.style.backgroundRepeat = 'no-repeat';
  div.style.backgroundPosition = 'center';
  div.style.backgroundSize = 'contain';
  div.dataset.id = n.id;

  const bar = document.createElement('div'); bar.classList.add('happiness-bar');
  const fill = document.createElement('div'); fill.classList.add('happiness-fill');
  fill.style.width = n.happiness+'%';
  bar.appendChild(fill); div.appendChild(bar);
  n.barFill = fill;
  div.onclick = ()=>clickNamling(n.id);
  gameArea.appendChild(div);
  return div;
}

// --- Movement ---
function animate(){
  namlings.forEach((n,i)=>{
    n.x += n.dx||1.5; n.y += n.dy||1.2;
    if(n.x<0||n.x>window.innerWidth-80) n.dx*=-1;
    if(n.y<0||n.y>window.innerHeight-80) n.dy*=-1;
    const el = namlingElements[i];
    el.style.left = n.x+'px';
    el.style.top = n.y+'px';
    el.style.transform = `scaleX(${n.dx>0?1:-1})`;
    if(el.classList.contains('panic')) el.style.transform += ' scale(1.2)';
  });
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

// --- Click Namling ---
function clickNamling(id){
  const n = namlings.find(n=>n.id===id);
  const el = namlingElements.find(el=>el.dataset.id==id);
  el.classList.add('panic'); setTimeout(()=>el.classList.remove('panic'),400);
  playRandomScream(); addCoins(1); selectedNamling=n; showTutorialStep(4); saveGame();
}

// --- Screams ---
function playRandomScream(){ const s = Math.floor(Math.random()*4)+1; new Audio(`scream${s}.mp3.mp3`).play(); }

// --- Coins ---
function addCoins(amount){ namcoins+=amount; namcoinsDisplay.textContent=namcoins; saveGame(); }

// --- Overlays ---
function openInventory(){ renderInventory(); document.getElementById('inventoryOverlay').style.display='flex'; showTutorialStep(2); }
function openShop(){ renderShop(); document.getElementById('shopOverlay').style.display='flex'; showTutorialStep(1); }
function openSettings(){ document.getElementById('settingsOverlay').style.display='flex'; }
function closeOverlay(){ document.querySelectorAll('.overlay').forEach(o=>o.style.display='none'); }

// --- Inventory ---
function renderInventory(){
  const invList = document.getElementById('inventoryList'); invList.innerHTML='';
  if(Object.keys(inventory).length===0){ invList.innerHTML='<p>No items yet.</p>'; return; }
  Object.keys(inventory).forEach(name=>{
    const div = document.createElement('div'); div.classList.add('item');
    let actionButton = eggs.find(e=>e.name===name)? `<button onclick="hatchEggAnimated('${name}')">Hatch</button>` : `<button onclick="feedNamling('${name}')">Feed</button>`;
    div.innerHTML=`<img src="${inventory[name].img}" alt="${name}"><span>${name} x${inventory[name].qty}</span>${actionButton}`;
    invList.appendChild(div);
  });
}

// --- Shop ---
function renderShop(){
  const shopList=document.getElementById('shopList'); shopList.innerHTML='<h3>Food</h3>';
  foodItems.forEach(f=>{
    const div=document.createElement('div'); div.classList.add('item');
    div.innerHTML=`<img src="${f.name=='Namtoy'?'namtoy.png':'namtoy.png'}" alt="${f.name}"><span>${f.name} - ${f.price} Namcoins</span><button onclick="buyItem('${f.name}',${f.price})">Buy</button>`;
    shopList.appendChild(div);
  });
  shopList.innerHTML+='<h3>Eggs</h3>';
  eggs.forEach(e=>{
    const div=document.createElement('div'); div.classList.add('item');
    div.innerHTML=`<img src="${e.img}" alt="${e.name}"><span>${e.name} - ${e.price} Namcoins</span><button onclick="buyEgg('${e.name}')">Buy</button>`;
    shopList.appendChild(div);
  });
}

// --- Buy Items ---
function buyItem(name,price){
  if(namcoins<price){alert('Not enough Namcoins'); return;}
  namcoins-=price; namcoinsDisplay.textContent=namcoins;
  inventory[name]=inventory[name]||{qty:0,img:name=='Namtoy'?'namtoy.png':'namtoy.png'}; inventory[name].qty++;
  renderInventory(); saveGame();
}

function buyEgg(name){
  const egg=eggs.find(e=>e.name===name);
  if(namcoins<egg.price){alert('Not enough Namcoins'); return;}
  namcoins-=egg.price; namcoinsDisplay.textContent=namcoins;
  inventory[name]=inventory[name]||{qty:0,img:egg.img}; inventory[name].qty++;
  renderInventory(); saveGame();
}

// --- Feed ---
function feedNamling(food){
  if(!selectedNamling){alert('Click a Namling first!');return;}
  if(inventory[food]&&inventory[food].qty>0){
    inventory[food].qty--;
    selectedNamling.happiness=Math.min(100,selectedNamling.happiness+10);
    selectedNamling.barFill.style.width=selectedNamling.happiness+'%';
    renderInventory(); saveGame();
    alert(`Namling ${selectedNamling.id} ate ${food}! Happiness +10`);
    showTutorialStep(4);
  } else alert('You do not have this food.');
}

// --- Hatch with animation ---
function hatchEggAnimated(name){
  if(!inventory[name]||inventory[name].qty<=0){alert('No egg to hatch!');return;}
  const egg = eggs.find(e=>e.name===name);
  inventory[name].qty--; renderInventory(); saveGame();
  
  // Egg div center
  const eggDiv = document.createElement('div');
  eggDiv.style.position='absolute';
  eggDiv.style.width='80px';
  eggDiv.style.height='80px';
  eggDiv.style.left=window.innerWidth/2-40+'px';
  eggDiv.style.top=window.innerHeight/2-40+'px';
  eggDiv.style.backgroundImage=`url('${egg.img}')`;
  eggDiv.style.backgroundSize='contain';
  eggDiv.style.backgroundPosition='center';
  eggDiv.style.backgroundRepeat='no-repeat';
  gameArea.appendChild(eggDiv);

  let shake=0;
  const shakeInterval = setInterval(()=>{
    eggDiv.style.transform = `translateX(${Math.sin(shake)*10}px)`;
    shake+=0.3;
    if(shake>20){ clearInterval(shakeInterval); crackEgg(); }
  },50);

  function crackEgg(){
    setTimeout(()=>{
      const newId = egg.range[0]+Math.floor(Math.random()*(egg.range[1]-egg.range[0]+1));
      if(!hatchedNamlings.includes(newId)){
        hatchedNamlings.push(newId);
        const n = {id:newId,x:Math.random()*(window.innerWidth-80),y:Math.random()*(window.innerHeight-80),happiness:50,img:`namling${newId}.png`,dx:1.5,dy:1.2};
        namlings.push(n); namlingElements.push(createNamling(n));
        // sparkle
        const sparkle = document.createElement('div');
        sparkle.style.position='absolute';
        sparkle.style.left=n.x+'px';
        sparkle.style.top=n.y+'px';
        sparkle.style.width='80px';
        sparkle.style.height='80px';
        sparkle.style.background='radial-gradient(circle,#fff,#ff0,#f00)';
        sparkle.style.borderRadius='50%';
        gameArea.appendChild(sparkle);
        setTimeout(()=>gameArea.removeChild(sparkle),800);
        alert(`You hatched Namling ${newId}!`);
        showTutorialStep(3); saveGame();
      }
      gameArea.removeChild(eggDiv);
    },500);
  }
}

// --- Tutorial ---
let tutorialStep=0;
function showTutorialStep(step){
  if(step<=tutorialStep) return; tutorialStep=step;
  switch(step){
    case 0: tutorialDiv.textContent='Welcome! Open the shop to buy your first egg.'; break;
    case 1: tutorialDiv.textContent='Buy an egg from the shop!'; break;
    case 2: tutorialDiv.textContent='Open your inventory to see your egg.'; break;
    case 3: tutorialDiv.textContent='Hatch your egg to get your first Namling!'; break;
    case 4: tutorialDiv.textContent='Click your Namling to select it, then feed it!'; break;
    case 5: tutorialDiv.textContent='Try the mini-game to earn extra Namcoins!'; break;
    default: tutorialDiv.style.display='none'; return;
  }
  tutorialDiv.style.display='block'; setTimeout(()=>{tutorialDiv.style.display='none';},5000);
}
showTutorialStep(0);

// --- Mini-game ---
function startMiniGame(){
  showTutorialStep(5);
  const targets = [];
  for(let i=0;i<5;i++){
    const t = document.createElement('div');
    t.classList.add('miniTarget');
    t.style.left=Math.random()*(window.innerWidth-40)+'px';
    t.style.top=Math.random()*(window.innerHeight-40)+'px';
    t.onclick = ()=>{ addCoins(5); gameArea.removeChild(t); };
    gameArea.appendChild(t); targets.push(t);
    let dx = (Math.random()<0.5?-1:1)*2, dy=(Math.random()<0.5?-1:1)*2;
    const interval = setInterval(()=>{
      let x=parseFloat(t.style.left),y=parseFloat(t.style.top);
      x+=dx; y+=dy;
      if(x<0||x>window.innerWidth-40) dx*=-1;
      if(y<0||y>window.innerHeight-40) dy*=-1;
      t.style.left=x+'px'; t.style.top=y+'px';
    },30);
    setTimeout(()=>{ clearInterval(interval); if(t.parentElement) gameArea.removeChild(t); },5000);
  }
}

// --- Settings ---
function resetGame(){ if(confirm('Reset game?')){ localStorage.removeItem('namgyuSave'); location.reload(); } }
function toggleMusic(){ if(bgMusic.paused) bgMusic.play(); else bgMusic.pause(); }
// --- Dragging ---
let dragging = null, offsetX = 0, offsetY = 0;
gameArea.addEventListener("mousedown", e=>{
  if(e.target.classList.contains("namling")){
    const id = parseInt(e.target.dataset.id);
    const n = namlings.find(nn=>nn.id===id);
    dragging = { n, el: e.target };
    offsetX = e.clientX - n.x;
    offsetY = e.clientY - n.y;
    e.target.style.transition = "transform 0.1s";
    e.target.style.transform = "scale(0.9,0.8)";
    n.dx = n.dy = 0; // pause while dragging
  }
});
window.addEventListener("mousemove", e=>{
  if(dragging){
    dragging.n.x = e.clientX - offsetX;
    dragging.n.y = e.clientY - offsetY;
    dragging.el.style.left = dragging.n.x+"px";
    dragging.el.style.top = dragging.n.y+"px";
  }
});
window.addEventListener("mouseup", ()=>{
  if(dragging){
    dragging.n.dx = (Math.random()*2-1)*2;
    dragging.n.dy = (Math.random()*2-1)*2;
    dragging.el.style.transform = "scale(1,1)";
    dragging = null;
  }
});

// --- Random antics every few seconds ---
setInterval(()=>{
  if(namlings.length===0) return;
  const n = namlings[Math.floor(Math.random()*namlings.length)];
  const el = namlingElements.find(el=>el.dataset.id==n.id);
  const r = Math.random();
  if(r<0.25){ // spin
    el.style.transition="transform 0.6s";
    el.style.transform += " rotate(360deg)";
    setTimeout(()=>el.style.transition="",700);
  } else if(r<0.5){ // burp
    showSpeechBubble(el,"*burp*");
    new Audio("burp.mp3").play();
  } else if(r<0.75){ // fart
    showSpeechBubble(el,"💨");
    new Audio("fart.mp3").play();
  } else { // insult
    const insults=["loser","bozo","cry about it","skill issue","ur mom"];
    showSpeechBubble(el,insults[Math.floor(Math.random()*insults.length)]);
  }
},4000);

// --- Fighting when colliding ---
function checkFights(){
  for(let i=0;i<namlings.length;i++){
    for(let j=i+1;j<namlings.length;j++){
      const a=namlings[i], b=namlings[j];
      if(Math.abs(a.x-b.x)<60 && Math.abs(a.y-b.y)<60){
        const elA=namlingElements[i], elB=namlingElements[j];
        elA.classList.add("fighting"); elB.classList.add("fighting");
        showSpeechBubble(elA,"⚔️"); showSpeechBubble(elB,"⚔️");
        a.dx=a.dy=b.dx=b.dy=0;
        // stop when clicked
        elA.onclick=()=>{elA.classList.remove("fighting"); clickNamling(a.id);}
        elB.onclick=()=>{elB.classList.remove("fighting"); clickNamling(b.id);}
      }
    }
  }
  requestAnimationFrame(checkFights);
}
checkFights();

// --- Helper: speech bubble ---
function showSpeechBubble(el,text){
  const bubble=document.createElement("div");
  bubble.textContent=text;
  bubble.style.position="absolute";
  bubble.style.top="-30px";
  bubble.style.left="0";
  bubble.style.padding="2px 6px";
  bubble.style.background="white";
  bubble.style.border="1px solid black";
  bubble.style.borderRadius="6px";
  bubble.style.fontSize="12px";
  bubble.style.whiteSpace="nowrap";
  el.appendChild(bubble);
  setTimeout(()=>el.removeChild(bubble),1500);
}
// --- Auto-save every minute ---
setInterval(saveGame,60000);
</script>
</body>
</html>

